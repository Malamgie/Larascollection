<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account | Lara's Collection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sacramento&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script>
        // NOTE: You must replace this with your actual Firebase config
        const firebaseConfig = {
          // apiKey: "YOUR_API_KEY",
          // authDomain: "YOUR_AUTH_DOMAIN",
          // projectId: "YOUR_PROJECT_ID",
          // ... other settings
        };
        
        // Initialize Firebase (uncomment when config is added)
        // firebase.initializeApp(firebaseConfig);
        // const auth = firebase.auth();
        // const db = firebase.firestore();
    </script>

    <style>
        .brand-name {
            font-family: 'Sacramento', cursive;
        }
        /* Styles copied from previous pages */
        .desktop-shop-menu {
            transition: opacity 0.3s ease, visibility 0.3s ease;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .desktop-shop-menu.visible {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
        #utility-sidebar {
            transition: transform 0.3s ease-in-out;
            transform: translateX(100%);
        }
        #utility-sidebar.open {
            transform: translateX(0);
        }
        #mobile-menu {
            transition: transform 0.3s ease-in-out;
            transform: translateX(-100%);
        }
        #mobile-menu.open {
            transform: translateX(0);
        }
        /* Styling for active tab/link */
        .account-nav-link.active {
            font-weight: 700; /* Bold */
            color: #8B0000; /* deep-burgundy */
            border-left: 4px solid #C9A04B; /* accent-gold border */
            background-color: #F9F7F4; /* primary-beige background */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-beige': '#F9F7F4',
                        'accent-gold': '#C9A04B',
                        'deep-burgundy': '#8B0000',
                        'text-dark': '#333333',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="font-sans bg-primary-beige text-text-dark antialiased">

    <div id="utility-sidebar-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="toggleSidebar('utility')"></div>
    <div id="utility-sidebar" class="fixed top-0 right-0 h-full w-64 bg-white shadow-xl z-50 p-6">
        <div class="flex justify-end mb-8">
            <button onclick="toggleSidebar('utility')" class="text-xl text-text-dark hover:text-deep-burgundy"><i data-lucide="x"></i></button>
        </div>
        <nav class="space-y-6">
            <a href="account.html" class="block text-lg hover:text-accent-gold">My Account</a>
        </nav>
    </div>
    
    <div id="mobile-menu-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="toggleSidebar('mobile')"></div>
    <div id="mobile-menu" class="fixed top-0 left-0 h-full w-64 bg-white shadow-xl z-50 p-6">
        <div class="flex justify-end mb-8">
            <button onclick="toggleSidebar('mobile')" class="text-xl text-text-dark hover:text-deep-burgundy"><i data-lucide="x"></i></button>
        </div>
        <nav class="space-y-4">
            <a href="index.html" class="block text-lg font-medium hover:text-accent-gold">Home</a>
            <a href="shop.html" class="block text-lg font-medium hover:text-accent-gold">Shop</a>
        </nav>
    </div>

    <header class="sticky top-0 bg-white bg-opacity-95 backdrop-blur-sm shadow-sm z-30">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 h-20 flex justify-between items-center">
            <h1 class="text-2xl font-bold tracking-widest text-text-dark"><span class="brand-name" >Lara's Collection</span></h1>

            <nav class="hidden lg:flex items-center space-x-10 text-lg font-medium">
                <a href="index.html" class="text-text-dark hover:text-accent-gold transition duration-150">Home</a>
                <a href="shop.html" class="text-text-dark hover:text-accent-gold transition duration-150">Shop</a>
                <a href="#" class="text-text-dark hover:text-accent-gold transition duration-150">Contact Us</a>
            </nav>

            <div class="flex items-center space-x-4">
                <a href="cart.html" class="flex items-center text-text-dark hover:text-accent-gold transition duration-150">
                    <i data-lucide="shopping-cart" class="w-6 h-6"></i>
                    <span id="cart-count" class="ml-1 text-sm">(0)</span>
                </a>
                <button onclick="toggleSidebar('utility')" class="text-deep-burgundy font-bold transition duration-150">
                   <i data-lucide="user" class="w-6 h-6 fill-deep-burgundy"></i>
                </button>
                <button onclick="toggleSidebar('mobile')" class="lg:hidden text-text-dark hover:text-accent-gold transition duration-150">
                    <i data-lucide="align-right" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <h2 class="text-4xl font-extrabold text-text-dark mb-8 border-b pb-4">My Account</h2>

        <div id="auth-section" class="max-w-4xl mx-auto grid md:grid-cols-2 gap-12 bg-white p-10 rounded-lg shadow-lg hidden">
            <div>
                <h3 class="text-2xl font-bold text-deep-burgundy mb-4">I am a Returning Customer</h3>
                <form id="login-form" class="space-y-4">
                    <div>
                        <label for="login-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                        <input type="email" id="login-email" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3 focus:ring-accent-gold focus:border-accent-gold">
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="login-password" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3 focus:ring-accent-gold focus:border-accent-gold">
                        <a href="#" class="text-xs text-accent-gold hover:text-deep-burgundy mt-1 block text-right">Forgot Password?</a>
                    </div>
                    <button type="submit" class="w-full py-3 bg-accent-gold text-white font-semibold rounded-md hover:bg-deep-burgundy transition duration-300">LOG IN</button>
                    <p id="login-error" class="text-red-500 text-sm mt-2 hidden">Invalid credentials. Please try again.</p>
                </form>
            </div>

            <div>
                <h3 class="text-2xl font-bold text-deep-burgundy mb-4">I am a New Customer</h3>
                <form id="register-form" class="space-y-4">
                    <div>
                        <label for="register-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                        <input type="text" id="register-name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3 focus:ring-accent-gold focus:border-accent-gold">
                    </div>
                    <div>
                        <label for="register-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                        <input type="email" id="register-email" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3 focus:ring-accent-gold focus:border-accent-gold">
                    </div>
                    <div>
                        <label for="register-password" class="block text-sm font-medium text-gray-700">Password (Min 6 chars)</label>
                        <input type="password" id="register-password" required minlength="6" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3 focus:ring-accent-gold focus:border-accent-gold">
                    </div>
                    <button type="submit" class="w-full py-3 bg-deep-burgundy text-white font-semibold rounded-md hover:bg-accent-gold transition duration-300">CREATE ACCOUNT</button>
                    <p id="register-error" class="text-red-500 text-sm mt-2 hidden">Registration failed. Email may already be in use.</p>
                </form>
            </div>
        </div>

        <div id="dashboard-section" class="hidden lg:grid lg:grid-cols-4 gap-10">
            
            <aside class="lg:col-span-1">
                <nav class="space-y-2 bg-white p-4 rounded-lg shadow-md">
                    <a href="#" class="account-nav-link active block p-3 text-lg text-gray-700 hover:text-deep-burgundy transition" data-panel="overview">
                        <i data-lucide="layout-dashboard" class="w-5 h-5 inline mr-3"></i> Dashboard Overview
                    </a>
                    <a href="#" class="account-nav-link block p-3 text-lg text-gray-700 hover:text-deep-burgundy transition" data-panel="orders">
                        <i data-lucide="package" class="w-5 h-5 inline mr-3"></i> My Orders
                    </a>
                    <a href="#" class="account-nav-link block p-3 text-lg text-gray-700 hover:text-deep-burgundy transition" data-panel="addresses">
                        <i data-lucide="map-pin" class="w-5 h-5 inline mr-3"></i> Saved Addresses
                    </a>
                    <a href="#" class="account-nav-link block p-3 text-lg text-gray-700 hover:text-deep-burgundy transition" data-panel="profile">
                        <i data-lucide="settings" class="w-5 h-5 inline mr-3"></i> Account Details
                    </a>
                    <button onclick="logout()" class="w-full text-left p-3 text-lg text-red-500 hover:text-red-700 transition">
                        <i data-lucide="log-out" class="w-5 h-5 inline mr-3"></i> Log Out
                    </button>
                </nav>
            </aside>

            <section class="lg:col-span-3 bg-white p-8 rounded-lg shadow-md">
                
                <div id="panel-overview" class="account-panel">
                    <h3 class="text-2xl font-bold text-text-dark mb-4">Welcome back, <span id="user-display-name">Guest</span>!</h3>
                    <p class="text-gray-600 mb-6">From your account dashboard you can view your recent orders, manage your shipping and billing addresses, and edit your password and account details.</p>
                    
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div class="bg-primary-beige p-4 rounded-lg">
                            <i data-lucide="package" class="w-8 h-8 mx-auto text-accent-gold mb-2"></i>
                            <p class="text-2xl font-bold text-deep-burgundy" id="total-orders">0</p>
                            <p class="text-sm text-gray-600">Total Orders</p>
                        </div>
                        <div class="bg-primary-beige p-4 rounded-lg">
                            <i data-lucide="shipping-box" class="w-8 h-8 mx-auto text-accent-gold mb-2"></i>
                            <p class="text-2xl font-bold text-deep-burgundy" id="pending-orders">0</p>
                            <p class="text-sm text-gray-600">Pending Shipment</p>
                        </div>
                        <div class="bg-primary-beige p-4 rounded-lg">
                            <i data-lucide="map-pin" class="w-8 h-8 mx-auto text-accent-gold mb-2"></i>
                            <p class="text-2xl font-bold text-deep-burgundy">1</p>
                            <p class="text-sm text-gray-600">Saved Address</p>
                        </div>
                    </div>
                    
                    <h4 class="text-xl font-bold text-text-dark mt-8 mb-4">Recent Orders</h4>
                    <div id="recent-orders-list">
                        <p class="text-gray-500">No recent orders found. <a href="shop.html" class="text-accent-gold hover:text-deep-burgundy">Start shopping!</a></p>
                    </div>
                </div>

                <div id="panel-orders" class="account-panel hidden">
                    <h3 class="text-2xl font-bold text-text-dark mb-4">My Orders History</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order #</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="5" class="py-4 text-center text-gray-500">Loading orders...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="panel-addresses" class="account-panel hidden">
                    <h3 class="text-2xl font-bold text-text-dark mb-4">Saved Addresses</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="border p-4 rounded-lg bg-primary-beige">
                            <h4 class="font-semibold text-lg mb-2">Billing Address</h4>
                            <p id="billing-address">No billing address saved.</p>
                            <button class="mt-3 text-accent-gold hover:text-deep-burgundy text-sm">Edit Address</button>
                        </div>
                        <div class="border p-4 rounded-lg bg-primary-beige">
                            <h4 class="font-semibold text-lg mb-2">Shipping Address</h4>
                            <p id="shipping-address">No shipping address saved.</p>
                            <button class="mt-3 text-accent-gold hover:text-deep-burgundy text-sm">Edit Address</button>
                        </div>
                    </div>
                </div>

                <div id="panel-profile" class="account-panel hidden">
                    <h3 class="text-2xl font-bold text-text-dark mb-4">Account Details</h3>
                    <form class="space-y-4 max-w-lg">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Name</label>
                            <input type="text" id="profile-name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3" value="Loading...">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" id="profile-email" readonly class="mt-1 block w-full border-gray-300 bg-gray-50 rounded-md shadow-sm p-3" value="loading@email.com">
                        </div>
                        <button type="submit" class="py-3 px-6 bg-accent-gold text-white font-semibold rounded-md hover:bg-deep-burgundy transition duration-300">SAVE CHANGES</button>
                    </form>
                </div>

            </section>
        </div>
    </main>


    <footer class="bg-text-dark text-primary-beige py-12 mt-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-4 gap-8">
            </div>
        <div class="border-t border-gray-700 mt-8 pt-6 container mx-auto px-4 text-center text-xs text-gray-500">
            &copy; 2024 Lara's Collection. All rights reserved.
        </div>
    </footer>

    <script>
        lucide.createIcons();
        
        // --- Shared UI Logic (Sidebar) ---
        function toggleSidebar(type) {
             // (function definition copied from previous pages)
        }

        // --- AUTHENTICATION & DASHBOARD LOGIC ---
        const authSection = document.getElementById('auth-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginError = document.getElementById('login-error');
        const registerError = document.getElementById('register-error');
        
        // 1. Authentication State Listener
        // This function is the heart of the page, checking if a user is logged in.
        // It relies on the Firebase 'auth' object being initialized.
        function setupAuthStateListener() {
            // Note: This block is pseudo-code until you include the Firebase config
            /*
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in, show dashboard
                    authSection.classList.add('hidden');
                    dashboardSection.classList.remove('hidden');
                    
                    // Update user info
                    document.getElementById('user-display-name').textContent = user.displayName || user.email;
                    document.getElementById('profile-email').value = user.email;
                    document.getElementById('profile-name').value = user.displayName || 'Set Name';

                    fetchDashboardData(user.uid);
                    
                } else {
                    // User is signed out, show login/register forms
                    authSection.classList.remove('hidden');
                    dashboardSection.classList.add('hidden');
                }
            });
            */
            
            // --- TEMP FALLBACK ---
            // Simulating a logged-out state initially for the layout
            authSection.classList.remove('hidden'); 
            dashboardSection.classList.add('hidden');
            // If you want to test the dashboard view:
            // authSection.classList.add('hidden'); 
            // dashboardSection.classList.remove('hidden');
            // fetchDashboardData('TEMP_USER_ID');
        }


        // 2. Login Handler
        if (loginForm) {
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                // *** FIREBASE ACTION: Sign In
                /*
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        loginError.classList.add('hidden');
                        // Listener will handle UI update
                    })
                    .catch((error) => {
                        console.error("Login failed:", error);
                        loginError.textContent = `Login failed: ${error.message.split('(')[0]}`;
                        loginError.classList.remove('hidden');
                    });
                */
               alert('LOGIN: Check console for simulated Firebase login attempt.');
            });
        }

        // 3. Register Handler
        if (registerForm) {
            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const name = document.getElementById('register-name').value;
                
                // *** FIREBASE ACTION: Create User
                /*
                auth.createUserWithEmailAndPassword(email, password)
                    .then((credential) => {
                        // Update display name immediately after creating the account
                        return credential.user.updateProfile({ displayName: name });
                    })
                    .then(() => {
                        registerError.classList.add('hidden');
                        // Listener will handle UI update
                    })
                    .catch((error) => {
                        console.error("Registration failed:", error);
                        registerError.textContent = `Registration failed: ${error.message.split('(')[0]}`;
                        registerError.classList.remove('hidden');
                    });
                */
               alert('REGISTER: Check console for simulated Firebase registration attempt.');
            });
        }

        // 4. Logout Function
        function logout() {
            // *** FIREBASE ACTION: Sign Out
            /*
            auth.signOut().then(() => {
                // Listener will handle UI update
                alert('You have been logged out.');
            }).catch((error) => {
                console.error("Logout failed:", error);
            });
            */
           alert('LOGOUT: You have been signed out.');
           // TEMP: Manually reset UI to show forms
           authSection.classList.remove('hidden'); 
           dashboardSection.classList.add('hidden');
        }

        // 5. Fetch Dashboard Data (Orders/Addresses)
        function fetchDashboardData(userId) {
             // In a real app, use the userId to query Firestore for:
             // 1. Orders collection where 'userId' == userId
             // 2. User profile document to get addresses
             
             // --- TEMP DATA SIMULATION ---
             const orders = [
                 { id: 'O1001', date: '2024-10-15', status: 'Delivered', total: 45000, action: 'Reorder' },
                 { id: 'O1002', date: '2024-09-01', status: 'Processing', total: 72000, action: 'Track' },
             ];
             
             // Update overview stats
             document.getElementById('total-orders').textContent = orders.length;
             document.getElementById('pending-orders').textContent = orders.filter(o => o.status !== 'Delivered').length;

             // Populate orders table
             const tableBody = document.getElementById('orders-table-body');
             tableBody.innerHTML = orders.map(order => `
                 <tr class="hover:bg-gray-50">
                     <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-text-dark">${order.id}</td>
                     <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${order.date}</td>
                     <td class="px-6 py-4 whitespace-nowrap text-sm text-${order.status === 'Delivered' ? 'green' : 'orange'}-600">${order.status}</td>
                     <td class="px-6 py-4 whitespace-nowrap text-sm text-deep-burgundy font-semibold">N${order.total.toLocaleString()}</td>
                     <td class="px-6 py-4 whitespace-nowrap text-sm">
                         <button class="text-accent-gold hover:text-deep-burgundy">${order.action}</button>
                     </td>
                 </tr>
             `).join('');

             // Update recent orders (only show the last one)
             if (orders.length > 0) {
                 const recent = orders[0];
                 document.getElementById('recent-orders-list').innerHTML = `
                     <p class="text-gray-700">Order **${recent.id}** placed on ${recent.date} is currently **${recent.status}**.</p>
                 `;
             }
        }

        // 6. Dashboard Navigation Logic
        document.querySelectorAll('.account-nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetPanel = e.target.closest('a').getAttribute('data-panel');

                // Update active link state
                document.querySelectorAll('.account-nav-link').forEach(l => l.classList.remove('active'));
                e.target.closest('a').classList.add('active');

                // Switch visible panel
                document.querySelectorAll('.account-panel').forEach(panel => panel.classList.add('hidden'));
                document.getElementById(`panel-${targetPanel}`).classList.remove('hidden');
            });
        });


        // 7. Initializer
        document.addEventListener('DOMContentLoaded', () => {
            // Must be called to start checking the user's login status
            setupAuthStateListener(); 
            
            // Update cart count (copied from cart.html)
            const cartItems = JSON.parse(localStorage.getItem('cart') || '[]');
            document.getElementById('cart-count').textContent = `(${cartItems.length})`;
        });
    </script>
</body>
</html>